<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tu Entrenador y Dietista</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#ffa726" />
</head>
<body>
  <header>
    <h1>Plan TransformaciÃ³n 55 â†’ 80kg</h1>
    <p>Hasta el 5 de diciembre</p>
  </header>

  <main>
    <section id="calendario">
      <h2>ğŸ“… Calendario de Entrenamiento y Comidas</h2>
      <div id="dias"></div>
    </section>

    <section id="detalle-dia" class="hidden">
      <h2 id="titulo-dia"></h2>
      <div id="comidas"></div>
      <div id="entrenamiento"></div>
      <button id="btnCerrarDetalle" type="button">Cerrar</button>
    </section>

    <section id="progreso">
      <h2>ğŸ“ˆ Progreso</h2>
      <canvas id="graficoPeso" width="300" height="150"></canvas>
      <canvas id="graficoFuerza" width="300" height="150"></canvas>
      <div id="cuadroIMC" style="margin-top: 20px; font-size: 18px;"></div>
    </section>

    <section id="progreso-visual">
      <h2>ğŸ“¸ Progreso Visual (Antes vs DespuÃ©s)</h2>
      <div class="subida-fotos">
        <label for="fotoAntes">Foto Semana 1 (Antes):
          <input type="file" id="fotoAntes" accept="image/*" />
        </label>
        <label for="fotoDespues">Foto Semana Actual (DespuÃ©s):
          <input type="file" id="fotoDespues" accept="image/*" />
        </label>
      </div>
      <div id="comparador" class="hidden">
        <div class="container-comparador">
          <div class="img-container">
            <img id="img-antes" alt="Foto antes" />
            <img id="img-despues" alt="Foto despuÃ©s" />
            <input type="range" min="0" max="100" value="50" id="sliderComparador" />
          </div>
        </div>
      </div>
    </section>

    <section id="boton-nutricion" style="text-align:center; margin: 30px 0;">
      <button onclick="window.location.href='nutricion.html'" 
              style="padding: 12px 25px; font-size: 16px; background-color: #ffa726; border: none; border-radius: 8px; color: white; cursor: pointer;">
        Ir a Mi NutriciÃ³n ğŸ
      </button>
    </section>

    <!-- Registro por voz o foto -->
    <section id="registro-comida">
      <h2>ğŸ½ï¸ Registrar Comida por Voz o Imagen</h2>
      <div class="registro-opciones">
        <button id="grabarAudio" type="button">ğŸ™ï¸ Grabar Voz</button>
        <button id="subirFotoPlato" type="button">ğŸ“¸ Subir Foto</button>
        <input type="file" id="inputFotoPlato" accept="image/*" style="display:none;" capture="environment" />
      </div>
      <div id="resultadoRegistro"></div>
    </section>

    <!-- Coach Virtual con IA -->
    <section id="coach-virtual">
      <h2>ğŸ¤– Coach Virtual</h2>
      <div class="chat-box" id="chat-box">
        <div class="mensaje ia">Hola, soy tu coach virtual. Â¿En quÃ© te puedo ayudar hoy?</div>
      </div>
      <div class="input-chat">
        <input type="text" id="entradaChat" placeholder="Escribe tu pregunta aquÃ­..." autocomplete="off" />
        <button id="btnEnviarPregunta" type="button">Enviar</button>
      </div>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Tu Plan Personalizado</p>
  </footer>

  <div id="barra-puntos"></div>

  <!-- Usa defer en los scripts para mejor rendimiento -->
  <script src="data.js" defer></script>
  <script src="workouts.js" defer></script>
  <script src="progreso.js" defer></script>
  <script src="main.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <script src="progreso-fotos.js" defer></script>
  <script src="nutricion.js" defer></script>
  <script src="recompensas.js" defer></script>

  <script>
    // InicializaciÃ³n y validaciones de eventos para mayor robustez
    document.addEventListener("DOMContentLoaded", () => {
      // Eventos para subida de fotos de progreso visual
      const fotoAntes = document.getElementById("fotoAntes");
      const fotoDespues = document.getElementById("fotoDespues");
      if (fotoAntes)
        fotoAntes.addEventListener("change", e => subirFoto(e, "antes"));
      if (fotoDespues)
        fotoDespues.addEventListener("change", e => subirFoto(e, "despues"));

      // BotÃ³n cerrar detalle del dÃ­a
      const btnCerrarDetalle = document.getElementById("btnCerrarDetalle");
      if (btnCerrarDetalle)
        btnCerrarDetalle.addEventListener("click", () => {
          const detalleDia = document.getElementById("detalle-dia");
          if (detalleDia) detalleDia.classList.add("hidden");
        });

      // BotÃ³n para subir foto de registro de comida
      const subirFotoPlato = document.getElementById("subirFotoPlato");
      const inputFotoPlato = document.getElementById("inputFotoPlato");
      if (subirFotoPlato && inputFotoPlato) {
        subirFotoPlato.addEventListener("click", () => inputFotoPlato.click());
      }
    });
  </script>
</body>
</html>
